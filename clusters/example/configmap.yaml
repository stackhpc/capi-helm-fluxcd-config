---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-example-config
  namespace: capi-self
data:
  values.yaml: |
    # Must match the name of the (sealed) secret in credentials.yaml
    cloudCredentialsSecretName: cluster-example-credentials

    kubernetesVersion: 1.30.0
    machineImageId: "<image id>"

    clusterNetworking:
      externalNetworkId: "<external net id>"

    controlPlane:
      machineFlavor: "<flavor id>"
      machineCount: 3

    nodeGroups:
      - name: md-0
        machineFlavor: "<flavor id>"
        machineCount: 3

    # oidc:
    #   issuerUrl: https://keycloak.example.com/realm/realm-name
    #   clientId: my-k8s-auth-client

    addons:
      # Use the cilium CNI
      cni:
        type: cilium

      # Enable the monitoring stack
      monitoring:
        enabled: true

      # Disable NFD and the NVIDIA/Mellanox operators
      nodeFeatureDiscovery:
        enabled: false
      nvidiaGPUOperator:
        enabled: false
      mellanoxNetworkOperator:
        enabled: false

      # custom:
      #   # Use a custom addon to manage OIDC RBAC rules
      #   oidc-rbac:
      #     kind: Manifests
      #     spec:
      #       namespace: oidc-system
      #       manifests:
      #         # Example of mapping OIDC group named 'admins' to
      #         # the Kubernetes cluster-admin role.
      #         oidc-cluster-admin.yaml: |
      #           apiVersion: rbac.authorization.k8s.io/v1
      #           kind: ClusterRoleBinding
      #           metadata:
      #             name: oidc-cluster-admin
      #           subjects:
      #             - apiGroup: rbac.authorization.k8s.io
      #               kind: Group
      #               name: oidc:admins
      #           roleRef:
      #             apiGroup: rbac.authorization.k8s.io
      #             kind: ClusterRole
      #             name: cluster-admin
